<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>How To Customize DDMs • dRiftDM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How To Customize DDMs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dRiftDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/dRiftDM.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/convert_dmc_parameters.html">How to Convert DMC's parameters</a></li>
    <li><a class="dropdown-item" href="../articles/customize_ddms.html">How To Customize DDMs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bucky2177/dRiftDM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>How To Customize DDMs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bucky2177/dRiftDM/blob/main/vignettes/customize_ddms.Rmd" class="external-link"><code>vignettes/customize_ddms.Rmd</code></a></small>
      <div class="d-none name"><code>customize_ddms.Rmd</code></div>
    </div>

    
    
<p>The <code>dRiftDM</code> package provides pre-built Drift-Diffusion
Models (DDMs, see <code><a href="../articles/dRiftDM.html">vignette("dRiftDM", "dRiftDM")</a></code>). However,
one of the strengths of <code>dRiftDM</code> is that it allows you to
customize models by specifying arbitrary component functions for the
drift rate, boundary, etc., and how the parameters relate across
conditions.</p>
<div class="section level2">
<h2 id="the-model-structure-in-driftdm">The Model Structure in dRiftDM<a class="anchor" aria-label="anchor" href="#the-model-structure-in-driftdm"></a>
</h2>
<p>To better understand how we can customize a DDM, we first need to
understand how models are structured within <code>dRiftDM</code> and how
model predictions are derived. Each model in <code>dRiftDM</code> is
essentially a list that has (among other things) two important
entries:</p>
<ul>
<li><p><code>flex_prms_obj</code> containing a so-called
<code>flex_prms</code> object, which controls the parameters</p></li>
<li><p><code>comp_funs</code> a list of “component” functions that
represent the model’s drift rate, boundary, etc.</p></li>
</ul>
<p>We can see these entries by addressing the labels of the underlying
list:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ratcliff_dm.html">ratcliff_dm</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># some model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">a_model</span><span class="op">)</span> <span class="co"># the entries of the underlying list</span></span>
<span><span class="co">#&gt; [1] "flex_prms_obj" "prms_solve"    "solver"        "comp_funs"</span></span></code></pre></div>
<p>With the <code>flex_prms</code> object (stored as the first entry),
we can specify the parameters of the model and also control how each
parameter relates across conditions. For example, we could specify that
a parameter <code>A</code> in condition <code>incomp</code> is the
negative of parameter <code>A</code> in condition <code>comp</code>. Or
we could specify that a parameter <code>muc</code> is estimated
separately for two conditions.</p>
<p>With the functions stored in <code>comp_funs</code> (the fourth
entry), we can control the drift rate, boundary, starting point, and
non-decision time. Each function takes a set of arguments, including the
model parameters, and returns a vector of values. For example, the drift
rate function returns the drift rate of the diffusion model for each
time step.</p>
<p>When deriving the model predictions, the <code>comp_funs</code> are
evaluated with the currently set parameter values controlled by the
<code>flex_prms</code> object. Dedicated numerical algorithms in the
depths of <code>dRiftDM</code> then derive the model’s predicted
probability density functions of response times and choices. It is
important to emphasize this interaction of <code>comp_funs</code> with
the <code>flex_prms</code> object, as you will need to ensure that the
two work together smoothly. For example, a function stored in
<code>comp_funs</code> might fail if it is given a parameter vector that
it does not expect. Or a model might not work as expected if a function
stored in <code>comp_funs</code> doesn’t return code for a certain
parameter. We tried to emphasize the workflow in the following
diagram:</p>
<p><img src="evaluation_chain.png" width="90%"></p>
<p>Given this, there are two ways to customize a model, and depending on
the problem, you may need to consider both or only one.</p>
<p>1.) You can modify a model’s <code>flex_prms</code> object. This is
relevant whenever you want to change how the parameters of a model
relate across conditions.</p>
<p>2.) You can customize the component functions. This is relevant
whenever you want to have a different drift rate, boundary, starting
point, or non-decision time.</p>
</div>
<div class="section level2">
<h2 id="modifying-flex_prms-objects">Modifying <code>flex_prms</code> objects<a class="anchor" aria-label="anchor" href="#modifying-flex_prms-objects"></a>
</h2>
<p>We can access the underlying <code>flex_prms</code> object of a model
with the generic <code><a href="../reference/flex_prms.html">flex_prms()</a></code> accessor method:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a model (here the Diffusion Model for Conflict Tasks, DMC)</span></span>
<span><span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dmc_dm.html">dmc_dm</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/flex_prms.html">flex_prms</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="co">#&gt; Current Parameter Matrix:</span></span>
<span><span class="co">#&gt;        muc   b non_dec sd_non_dec  tau a    A alpha</span></span>
<span><span class="co">#&gt; comp     4 0.6     0.3       0.02 0.04 2  0.1     4</span></span>
<span><span class="co">#&gt; incomp   4 0.6     0.3       0.02 0.04 2 -0.1     4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unique Parameters:</span></span>
<span><span class="co">#&gt;        muc b non_dec sd_non_dec tau a A alpha</span></span>
<span><span class="co">#&gt; comp   1   2 3       4          5   0 6 7    </span></span>
<span><span class="co">#&gt; incomp 1   2 3       4          5   0 d 7    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Special Dependencies:</span></span>
<span><span class="co">#&gt; A ~ incomp == -(A ~ comp)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Custom Parameters:</span></span>
<span><span class="co">#&gt;        peak_l</span></span>
<span><span class="co">#&gt; comp     0.04</span></span>
<span><span class="co">#&gt; incomp   0.04</span></span></code></pre></div>
<p>Here we see the two core aspects of any <code>flex_prms</code> object
(see also the first print statement in
<code><a href="../articles/dRiftDM.html">vignette("dRiftDM", "dRiftDM")</a></code> for more information):</p>
<ul>
<li><p>The <strong>Current Parameter Matrix</strong> shows you the
current parameter value across all conditions.</p></li>
<li><p>The <strong>Unique Parameters</strong> show how each parameter
behaves across conditions.</p></li>
</ul>
<div class="section level3">
<h3 id="modifying-how-each-parameter-behaves-across-conditions">Modifying How Each Parameter Behaves Across Conditions<a class="anchor" aria-label="anchor" href="#modifying-how-each-parameter-behaves-across-conditions"></a>
</h3>
<p>The <strong>Unique Parameters</strong> are relevant to model
customization, and we can change them with the
<code><a href="../reference/modify_flex_prms.html">modify_flex_prms()</a></code> method. The function takes a model and a
set of <strong>instructions</strong> as a string. For example, if we
want <code>muc</code> to vary freely across conditions, we can write</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddm_free_muc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modify_flex_prms.html">modify_flex_prms</a></span><span class="op">(</span></span>
<span>  <span class="va">ddm</span>, <span class="co"># the model</span></span>
<span>  instr <span class="op">=</span> <span class="st">"muc ~"</span> <span class="co"># an instructions in a formula-like format</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/flex_prms.html">flex_prms</a></span><span class="op">(</span><span class="va">ddm_free_muc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Current Parameter Matrix:</span></span>
<span><span class="co">#&gt;        muc   b non_dec sd_non_dec  tau a    A alpha</span></span>
<span><span class="co">#&gt; comp     4 0.6     0.3       0.02 0.04 2  0.1     4</span></span>
<span><span class="co">#&gt; incomp   4 0.6     0.3       0.02 0.04 2 -0.1     4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unique Parameters:</span></span>
<span><span class="co">#&gt;        muc b non_dec sd_non_dec tau a A alpha</span></span>
<span><span class="co">#&gt; comp   1   3 4       5          6   0 7 8    </span></span>
<span><span class="co">#&gt; incomp 2   3 4       5          6   0 d 8    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Special Dependencies:</span></span>
<span><span class="co">#&gt; A ~ incomp == -(A ~ comp)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Custom Parameters:</span></span>
<span><span class="co">#&gt;        peak_l</span></span>
<span><span class="co">#&gt; comp     0.04</span></span>
<span><span class="co">#&gt; incomp   0.04</span></span></code></pre></div>
<p>Since there are now two numbers for <code>muc</code> under
<strong>Unique parameters</strong>, this parameter can take different
values for different conditions. This is also why <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>
now provides two (modifiable) values for <code>muc</code> per
condition:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span> <span class="co"># in this model muc is the same for all conditions</span></span>
<span><span class="co">#&gt;        muc          b    non_dec sd_non_dec        tau          A      alpha </span></span>
<span><span class="co">#&gt;       4.00       0.60       0.30       0.02       0.04       0.10       4.00</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ddm_free_muc</span><span class="op">)</span> <span class="co"># here muc can be different for the conditions</span></span>
<span><span class="co">#&gt;   muc.comp muc.incomp          b    non_dec sd_non_dec        tau          A </span></span>
<span><span class="co">#&gt;       4.00       4.00       0.60       0.30       0.02       0.04       0.10 </span></span>
<span><span class="co">#&gt;      alpha </span></span>
<span><span class="co">#&gt;       4.00</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ddm_free_muc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ddm_free_muc</span><span class="op">)</span></span>
<span><span class="co">#&gt;   muc.comp muc.incomp          b    non_dec sd_non_dec        tau          A </span></span>
<span><span class="co">#&gt;       5.00       4.00       0.60       0.30       0.02       0.04       0.10 </span></span>
<span><span class="co">#&gt;      alpha </span></span>
<span><span class="co">#&gt;       4.00</span></span></code></pre></div>
<p><code><a href="../reference/modify_flex_prms.html">modify_flex_prms()</a></code> supports the following instructions
(see the documentation for the syntax of each instruction):</p>
<ul>
<li><p>The vary instruction: Allows parameters to be estimated
independently across conditions.</p></li>
<li><p>The “restrain” instruction: Force parameters to be identical
across conditions.</p></li>
<li><p>The “fix” instruction: Keep parameters constant. They don’t vary
while the remaining parameters are estimated.</p></li>
<li><p>The “special dependency” instruction: Sometimes we want a
parameter in one condition to depend on another parameter in a second
condition. An example of this is already shown in the
<code>flex_prms(ddm)</code> output above. Here the parameter
<code>A</code> in the condition <code>incomp</code> is the negative of
the parameter in the condition <code>comp</code>.</p></li>
<li><p>The “custom parameter” instruction: Sometimes, we want to
calculate a linear combination of the model parameters. An example for
this is already shown in the <code>flex_prms(ddm)</code> output above.
Here, we have the custom parameter <code>peak_l</code>, which is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mi>t</mi><mi>a</mi><mi>u</mi></mrow><annotation encoding="application/x-tex">(a-1)\cdot tau</annotation></semantics></math>
(the equation is not apparent from the output).</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="defining-new-conditions">Defining New Conditions<a class="anchor" aria-label="anchor" href="#defining-new-conditions"></a>
</h3>
<p>The current conditions of a model can be accessed with the
<code><a href="../reference/conds.html">conds()</a></code> method:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/conds.html">conds</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "comp"   "incomp"</span></span></code></pre></div>
<p>We can assign new values to change these conditions. For example, a
researcher may want to introduce a neutral condition:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/conds.html">conds</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"comp"</span>, <span class="st">"neutral"</span>, <span class="st">"incomp"</span><span class="op">)</span></span>
<span><span class="co">#&gt; resetting parameter specifications</span></span></code></pre></div>
<p>Here we receive a message reminding us that all parameter values have
been reset. In fact, when we print out the underlying
<code>flex_prms</code> object, we see that the previous settings are
gone (e.g., <code>A</code> in the <code>incomp</code> condition is no
longer the negative of <code>A</code> in the <code>comp</code>
condition):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flex_prms.html">flex_prms</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="co">#&gt; Current Parameter Matrix:</span></span>
<span><span class="co">#&gt;         muc   b non_dec sd_non_dec  tau a   A alpha</span></span>
<span><span class="co">#&gt; comp      4 0.6     0.3       0.02 0.04 2 0.1     4</span></span>
<span><span class="co">#&gt; neutral   4 0.6     0.3       0.02 0.04 2 0.1     4</span></span>
<span><span class="co">#&gt; incomp    4 0.6     0.3       0.02 0.04 2 0.1     4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unique Parameters:</span></span>
<span><span class="co">#&gt;         muc b non_dec sd_non_dec tau a A alpha</span></span>
<span><span class="co">#&gt; comp      1 2       3          4   5 6 7     8</span></span>
<span><span class="co">#&gt; neutral   1 2       3          4   5 6 7     8</span></span>
<span><span class="co">#&gt; incomp    1 2       3          4   5 6 7     8</span></span></code></pre></div>
<p>While this may be a bit annoying in some cases, it actually makes
sense because there is no way for dRifDM to know how the new conditions
relate to the old ones. Consequently, we would now have to modify the
underlying <code>flex_prms</code> object again to suit our needs. For
example, we could restore the previous behavior for <code>A</code> in
<code>incomp</code> conditions, while setting it to zero for the new
<code>neutral</code> condition. We might also want to keep
<code>a</code> again fixed for all conditions:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">instructions</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">a &lt;!&gt;                      # 'a' is fixed across all conditions</span></span>
<span><span class="st">A ~ incomp == -(A ~ comp)  # A in incomp is -A in comp</span></span>
<span><span class="st">A &lt;!&gt; neutral              # A is fixed for the neutral condition</span></span>
<span><span class="st">A ~ neutral =&gt; 0           # A is zero for the neutral condition</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modify_flex_prms.html">modify_flex_prms</a></span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="va">ddm</span>,</span>
<span>  instr <span class="op">=</span> <span class="va">instructions</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="co">#&gt; Class(es): dmc_dm, drift_dm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Current Parameter Matrix:</span></span>
<span><span class="co">#&gt;         muc   b non_dec sd_non_dec  tau a    A alpha</span></span>
<span><span class="co">#&gt; comp      4 0.6     0.3       0.02 0.04 2  0.1     4</span></span>
<span><span class="co">#&gt; neutral   4 0.6     0.3       0.02 0.04 2  0.0     4</span></span>
<span><span class="co">#&gt; incomp    4 0.6     0.3       0.02 0.04 2 -0.1     4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unique Parameters:</span></span>
<span><span class="co">#&gt;         muc b non_dec sd_non_dec tau a A alpha</span></span>
<span><span class="co">#&gt; comp    1   2 3       4          5   0 6 7    </span></span>
<span><span class="co">#&gt; neutral 1   2 3       4          5   0 0 7    </span></span>
<span><span class="co">#&gt; incomp  1   2 3       4          5   0 d 7    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Special Dependencies:</span></span>
<span><span class="co">#&gt; A ~ incomp == -(A ~ comp)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deriving PDFs:</span></span>
<span><span class="co">#&gt;   solver: kfe</span></span>
<span><span class="co">#&gt;   values: sigma=1, t_max=3, dt=0.001, dx=0.001, nt=3000, nx=2000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Observed Data: NULL</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="customizing-component-functions">Customizing Component Functions<a class="anchor" aria-label="anchor" href="#customizing-component-functions"></a>
</h2>
<p>As mentioned above, another way to customize a model is to change the
component functions for the drift rate, boundary, start point, or
non-decision time. We can access each component function using the
<code><a href="../reference/comp_funs.html">comp_funs()</a></code> method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dmc_dm.html">dmc_dm</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># some pre-built model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/comp_funs.html">comp_funs</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mu_fun"     "mu_int_fun" "x_fun"      "b_fun"      "dt_b_fun"  </span></span>
<span><span class="co">#&gt; [6] "nt_fun"</span></span></code></pre></div>
<ul>
<li><p><code>mu_fun()</code> and <code>mu_int_fun()</code> are the drift
rate and its integral. The integral is required as an entry, but is only
evaluated if the user chooses the non-default method “im_zero” when
deriving model predictions.</p></li>
<li><p><code>x_fun()</code> returns the density for the initial
distribution.</p></li>
<li><p>The <code>b_fun()</code> and <code>dt_b_fun()</code> functions
returns the (upper) boundary and its derivative, respectively.</p></li>
<li><p>Finally, <code>nt_fun()</code> returns the density of the
non-decision time.</p></li>
</ul>
<p>A number of predefined component functions are available via
<code><a href="../reference/component_shelf.html">component_shelf()</a></code> (see the documentation for a description
of each function):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component_shelf.html">component_shelf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">all_funs</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "mu_constant"         "mu_dmc"              "mu_ssp"             </span></span>
<span><span class="co">#&gt;  [4] "mu_int_constant"     "mu_int_dmc"          "x_dirac_0"          </span></span>
<span><span class="co">#&gt;  [7] "x_beta"              "x_uniform"           "b_constant"         </span></span>
<span><span class="co">#&gt; [10] "b_hyperbol"          "b_weibull"           "dt_b_constant"      </span></span>
<span><span class="co">#&gt; [13] "dt_b_hyperbol"       "dt_b_weibull"        "nt_constant"        </span></span>
<span><span class="co">#&gt; [16] "nt_uniform"          "nt_truncated_normal" "dummy_t"</span></span></code></pre></div>
<p>The structure of each of these component functions is generally the
same. The drift rate, boundary, and non-decision time functions (i.e.,
mu_fun, mu_int_fun, b_fun, dt_b_fun, and nt_fun) must have the following
declaration:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">...</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prms_model</span>, <span class="va">prms_solve</span>, <span class="va">t_vec</span>, <span class="va">one_cond</span>, <span class="va">ddm_opts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ul>
<li>
<code>prms_model</code> is a named numeric vector and is identical
to a row of the <strong>Parameter Matrix</strong> of a model.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flex_prms.html">flex_prms</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="co">#&gt; Current Parameter Matrix:</span></span>
<span><span class="co">#&gt;        muc   b non_dec sd_non_dec  tau a    A alpha</span></span>
<span><span class="co">#&gt; comp     4 0.6     0.3       0.02 0.04 2  0.1     4</span></span>
<span><span class="co">#&gt; incomp   4 0.6     0.3       0.02 0.04 2 -0.1     4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unique Parameters:</span></span>
<span><span class="co">#&gt;        muc b non_dec sd_non_dec tau a A alpha</span></span>
<span><span class="co">#&gt; comp   1   2 3       4          5   0 6 7    </span></span>
<span><span class="co">#&gt; incomp 1   2 3       4          5   0 d 7    </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Special Dependencies:</span></span>
<span><span class="co">#&gt; A ~ incomp == -(A ~ comp)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Custom Parameters:</span></span>
<span><span class="co">#&gt;        peak_l</span></span>
<span><span class="co">#&gt; comp     0.04</span></span>
<span><span class="co">#&gt; incomp   0.04</span></span></code></pre></div>
<ul>
<li>
<code>prms_solve</code> is a named numeric vector, including the
diffusion constant and the discretization settings. It is identical
to:</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prms_solve.html">prms_solve</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="co">#&gt; sigma t_max    dt    dx    nt    nx </span></span>
<span><span class="co">#&gt; 1e+00 3e+00 1e-03 1e-03 3e+03 2e+03</span></span></code></pre></div>
<ul>
<li>
<code>t_vec</code> is a numeric vector, representing the time space.
It is constructed from <code>dt</code> and <code>t_max</code>:</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prms_solve.html">prms_solve</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span><span class="op">[</span><span class="st">"t_max"</span><span class="op">]</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prms_solve.html">prms_solve</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span><span class="op">[</span><span class="st">"dt"</span><span class="op">]</span></span>
<span><span class="va">t_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">t_max</span>, <span class="va">dt</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">t_vec</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.000 0.001 0.002 0.003 0.004 0.005</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">t_vec</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.995 2.996 2.997 2.998 2.999 3.000</span></span></code></pre></div>
<ul>
<li><p><code>one_cond</code> is the label of the current condition for
which the model is being evaluated (i.e., a row name of the
<strong>Parameter Matrix</strong>).</p></li>
<li><p><code>ddm_opts</code> is taken directly from the model. It is
used as a backdoor to inject arbitrary <code>R</code> objects (see the
final comments below for an example)</p></li>
</ul>
<p>Each drift rate, boundary, and non-decision time function must return
a numeric vector of the same length as <code>t_vec</code> (see below for
examples).</p>
<ul>
<li><p>For the drift rate, these returned values represent the drift
rate (or its integral) at each time step.</p></li>
<li><p>For the boundary (or its derivative), these values are the
boundary values returned for the upper boundary at each time step. The
lower boundary is always assumed to be the negative of the upper
boundary. That is, the bounds are symmetric about zero.</p></li>
<li><p>Finally, the values returned for the non-decision time represent
the density values of the respective distribution.</p></li>
</ul>
<p>The declaration for the starting point function, <code>x_fun</code>,
is similar, with one exception. It must take the argument
<code>x_vec</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">...</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prms_model</span>, <span class="va">prms_solve</span>, <span class="va">x_vec</span>, <span class="va">one_cond</span>, <span class="va">ddm_opts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ul>
<li>
<code>x_vec</code> is a numeric vector, with the (standardized)
evidence space. It is constructed from <code>dx</code> and spans from -1
to 1:</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prms_solve.html">prms_solve</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span><span class="op">[</span><span class="st">"dx"</span><span class="op">]</span></span>
<span><span class="va">x_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="va">dx</span><span class="op">)</span></span></code></pre></div>
<p>Each starting point function must return a numeric vector of the same
length as <code>x_vec</code>, providing the density values of the
starting points over the evidence space.</p>
<p>In theory, you can simply replace component functions using the
replacement method for <code><a href="../reference/comp_funs.html">comp_funs()</a></code>. However, at runtime,
the values for the arguments <code>prms_model</code> and
<code>one_cond</code> come from a row of the model’s parameter matrix
(i.e., from the underlying <code>flex_prms</code> object). Thus, you
must ensure that each component function can handle the values supplied.
Consequently, directly swapping functions only makes sense when the
model parameters remain the same. The more general approach is to write
a function that assembles the model, as shown below.</p>
<div class="section level3">
<h3 id="example-custom-drift-rate">Example: Custom Drift Rate<a class="anchor" aria-label="anchor" href="#example-custom-drift-rate"></a>
</h3>
<p>Assume that we want a model with the following custom drift rate:
<span class="math display">$$\mu(t) = \left\{
  \begin{array}{ c l }
    muc + mua &amp; \quad \textrm{for compatible conditions} \\
    muc - mua &amp; \quad \textrm{for incompatible conditions}
  \end{array}
\right.$$</span> Thus, in compatible conditions, the drift rate at each
time step is the sum of the two drift rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>u</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">muc</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>u</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">mua</annotation></semantics></math>,
while in incompatible conditions it is their difference.</p>
<p>First, we write the corresponding drift rate function like this:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_mu</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prms_model</span>, <span class="va">prms_solve</span>, <span class="va">t_vec</span>, <span class="va">one_cond</span>, <span class="va">ddm_opts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># extract all parameters (one row of the parameter matrix)</span></span>
<span>  <span class="va">muc</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"muc"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">mua</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"mua"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sign</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"sign"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># and return the drift rate at each time step</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">muc</span> <span class="op">+</span> <span class="va">sign</span> <span class="op">*</span> <span class="va">mua</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_vec</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Within this function, we first extract the model parameters relevant
to the calculation of the drift rate. Then, depending on an auxiliary
parameter <code>sign</code>, we sum both parameters and return the
vector of drift rates for each time step.</p>
<p>The next step is to create a function that assembles the custom model
by calling dRiftDM’s backbone function <code><a href="../reference/drift_dm.html">drift_dm()</a></code>. Here we
define vectors for all model parameters and conditions. We then assemble
the model using not only our custom drift rate function, but also
pre-built functions for the boundary, start point, and non-decision
time.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;It would also be possible to omit the pre-built
functions for the boundary, start point, and non-decision time. In this
case dRiftDM will fall back to default settings, see also the
documentation for &lt;code&gt;comp\_funs()&lt;/code&gt;&lt;/p&gt;"><sup>1</sup></a>.
Finally, we ensure that the auxiliary sign parameter works as intended
by modifying the parameter settings with
<code><a href="../reference/modify_flex_prms.html">modify_flex_prms()</a></code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># define all parameters and conditions</span></span>
<span>  <span class="va">prms_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    muc <span class="op">=</span> <span class="fl">3</span>, mua <span class="op">=</span> <span class="fl">1</span>, sign <span class="op">=</span> <span class="fl">1</span>, <span class="co"># parameters for the custom drift rate function</span></span>
<span>    b <span class="op">=</span> <span class="fl">.6</span>, <span class="co"># parameter for a time-independent boundary "b"</span></span>
<span>    non_dec <span class="op">=</span> <span class="fl">.2</span> <span class="co"># parameter for a non-decision time "non_dec"</span></span>
<span>  <span class="op">)</span> </span>
<span>  <span class="va">conds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"comp"</span>, <span class="st">"incomp"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># get access to pre-built component functions</span></span>
<span>  <span class="va">comps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component_shelf.html">component_shelf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># call the drift_dm function which is the backbone of dRiftDM</span></span>
<span>  <span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/drift_dm.html">drift_dm</a></span><span class="op">(</span></span>
<span>    prms_model <span class="op">=</span> <span class="va">prms_model</span>,</span>
<span>    conds <span class="op">=</span> <span class="va">conds</span>,</span>
<span>    subclass <span class="op">=</span> <span class="st">"my_custom_model"</span>,</span>
<span>    mu_fun <span class="op">=</span> <span class="va">cust_mu</span>, <span class="co"># your custom drift rate function</span></span>
<span>    mu_int_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">dummy_t</span>, <span class="co"># a dummy function, because no integral of the drift rate is required per default</span></span>
<span>    x_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">x_dirac_0</span>, <span class="co"># pre-built dirac delta on zero for the starting point</span></span>
<span>    b_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">b_constant</span>, <span class="co"># pre-built time-independent boundary with parameter b</span></span>
<span>    dt_b_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">dt_b_constant</span>, <span class="co"># pre-built derivative of the boundary</span></span>
<span>    nt_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">nt_constant</span> <span class="co"># pre-built non-decision time with parameter non_dec</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># modify the flex_prms object to achieve the desired behavior of 'sign'</span></span>
<span>  <span class="co"># -&gt; don't consider 'sign' a free parameter to estimate and set it to -1</span></span>
<span>  <span class="co"># for incompatible conditions</span></span>
<span>  <span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modify_flex_prms.html">modify_flex_prms</a></span><span class="op">(</span><span class="va">ddm</span>, instr <span class="op">=</span> <span class="st">"sign &lt;!&gt;</span></span>
<span><span class="st">                                        sign ~ incomp =&gt; -1"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu">cust_model</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If we want to use the “im_zero” method to derive model predictions,
we also need to write a function for the integral of the drift rate:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_mu_int</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prms_model</span>, <span class="va">prms_solve</span>, <span class="va">t_vec</span>, <span class="va">one_cond</span>, <span class="va">ddm_opts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># extract all parameters (one row of the parameter matrix)</span></span>
<span>  <span class="va">muc</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"muc"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">mua</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"mua"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">sign</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"sign"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># and return the integral of the drift rate</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">muc</span> <span class="op">+</span> <span class="va">sign</span> <span class="op">*</span> <span class="va">mua</span><span class="op">)</span> <span class="op">*</span> <span class="va">t_vec</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function is then passed to the <code>mu_int_fun</code> argument
within the <code>cust_model()</code> function. Everything else is the
same.</p>
</div>
<div class="section level3">
<h3 id="example-custom-starting-point-distribution">Example: Custom Starting Point (Distribution)<a class="anchor" aria-label="anchor" href="#example-custom-starting-point-distribution"></a>
</h3>
<p>Suppose we want a model where the starting point of the diffusion
process is controlled by a parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>.
If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">z = 0.5</annotation></semantics></math>,
the starting point is zero. If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>&lt;</mo><mi>z</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0.5 &lt; z &lt; 1</annotation></semantics></math>,
the starting point is closer to the upper boundary. If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>z</mi><mo>&lt;</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">0 &lt; z &lt; 0.5</annotation></semantics></math>,
the start point is closer to the lower boundary. Such a custom starting
point distribution might look like this:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_x</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prms_model</span>, <span class="va">prms_solve</span>, <span class="va">x_vec</span>, <span class="va">one_cond</span>, <span class="va">ddm_opts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dx</span> <span class="op">&lt;-</span> <span class="va">prms_solve</span><span class="op">[[</span><span class="st">"dx"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"z"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="va">z</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">z</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># create a dirac delta for the starting point</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x_vec</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">z</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">dx</span> <span class="co"># make sure it integrates to 1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then we write a function that assembles the custom model:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># define all parameters and conditions</span></span>
<span>  <span class="va">prms_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    z <span class="op">=</span> <span class="fl">0.75</span>, <span class="co"># parameter for the custom starting point</span></span>
<span>    muc <span class="op">=</span> <span class="fl">4</span>, <span class="co"># parameter for a time-independent drift rate "muc"</span></span>
<span>    b <span class="op">=</span> <span class="fl">.6</span>, <span class="co"># parameter for a time-independent boundary "b"</span></span>
<span>    non_dec <span class="op">=</span> <span class="fl">.2</span> <span class="co"># parameter for a non-decision time "non_dec"</span></span>
<span>  <span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># each model must have a condition (in this example it is not relevant, so we just call it "foo")</span></span>
<span>  <span class="va">conds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># get access to pre-built component functions</span></span>
<span>  <span class="va">comps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component_shelf.html">component_shelf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># call the drift_dm function which is the backbone of dRiftDM</span></span>
<span>  <span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/drift_dm.html">drift_dm</a></span><span class="op">(</span></span>
<span>    prms_model <span class="op">=</span> <span class="va">prms_model</span>,</span>
<span>    conds <span class="op">=</span> <span class="va">conds</span>,</span>
<span>    subclass <span class="op">=</span> <span class="st">"my_custom_model"</span>,</span>
<span>    mu_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">mu_constant</span>, <span class="co"># time-independent drift rate with parameter muc</span></span>
<span>    mu_int_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">mu_int_constant</span>, <span class="co"># respective integral of the drift rate</span></span>
<span>    x_fun <span class="op">=</span> <span class="va">cust_x</span>, <span class="co"># custom starting point function with parameter z</span></span>
<span>    b_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">b_constant</span>, <span class="co"># time-independent boundary with parameter b</span></span>
<span>    dt_b_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">dt_b_constant</span>, <span class="co"># respective derivative of the boundary</span></span>
<span>    nt_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">nt_constant</span> <span class="co"># non-decision time with parameter non_dec</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu">cust_model</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-custom-boundary">Example: Custom Boundary<a class="anchor" aria-label="anchor" href="#example-custom-boundary"></a>
</h3>
<p>Remark: This example shows a reimplementation of the already
pre-built <code><a href="../reference/b_hyperbol.html">b_hyperbol()</a></code> and <code><a href="../reference/b_hyperbol.html">dt_b_hyperbol()</a></code>
component functions (see <code><a href="../reference/component_shelf.html">component_shelf()</a></code>.</p>
<p>Suppose we want collapsing boundaries. The formula for the upper
boundary should be
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>κ</mi><mo>⋅</mo><mfrac><mi>t</mi><mrow><mi>t</mi><mo>+</mo><msub><mi>t</mi><mn>0.5</mn></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">b(t) = b_0 \left(1-\kappa\cdot \frac{t}{t+t_{0.5}}\right)\,.</annotation></semantics></math>
Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mn>0</mn></msub><annotation encoding="application/x-tex">b_0</annotation></semantics></math>
is the initial value of the upper boundary,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>κ</mi><annotation encoding="application/x-tex">\kappa</annotation></semantics></math>
is the rate of collapse, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>0.5</mn></msub><annotation encoding="application/x-tex">t_{0.5}</annotation></semantics></math>
is the time at which the boundary has collapsed by half. Since
<code>dRiftDM</code> assumes symmetric boundaries, the lower bound is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">-b(t)</annotation></semantics></math>.</p>
<p>The corresponding R function for this is:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the boundary function</span></span>
<span><span class="va">cust_b</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prms_model</span>, <span class="va">prms_solve</span>, <span class="va">t_vec</span>, <span class="va">one_cond</span>, <span class="va">ddm_opts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">b0</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"b0"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">kappa</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"kappa"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">t05</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"t05"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">b0</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">kappa</span> <span class="op">*</span> <span class="va">t_vec</span> <span class="op">/</span> <span class="op">(</span><span class="va">t_vec</span> <span class="op">+</span> <span class="va">t05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>To make this work with <code>dRiftDM</code>, we also provide the
derivative of the boundary,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>d</mi><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><msub><mi>b</mi><mn>0</mn></msub><mo>⋅</mo><mi>κ</mi><mo>⋅</mo><msub><mi>t</mi><mn>0.5</mn></msub></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>+</mo><msub><mi>t</mi><mn>0.5</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">\frac{d}{dt} b(t) = -\left(\frac{b_0 \cdot \kappa \cdot t_{0.5}}{(t + t_{0.5})^2}\right)\,.</annotation></semantics></math></p>
<p>The corresponding R function for this is:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the derivative of the boundary function</span></span>
<span><span class="va">cust_dt_b</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prms_model</span>, <span class="va">prms_solve</span>, <span class="va">t_vec</span>, <span class="va">one_cond</span>, <span class="va">ddm_opts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">b0</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"b0"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">kappa</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"kappa"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">t05</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"t05"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">b0</span> <span class="op">*</span> <span class="va">kappa</span> <span class="op">*</span> <span class="va">t05</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">t_vec</span> <span class="op">+</span> <span class="va">t05</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then we write a function that assembles the custom model:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># define all parameters and conditions</span></span>
<span>  <span class="va">prms_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    b0 <span class="op">=</span> <span class="fl">0.6</span>, kappa <span class="op">=</span> <span class="fl">0.5</span>, t05 <span class="op">=</span> <span class="fl">0.15</span>, <span class="co"># parameters for the custom boundary</span></span>
<span>    muc <span class="op">=</span> <span class="fl">4</span>, <span class="co"># parameter for a time-independent drift rate "muc"</span></span>
<span>    non_dec <span class="op">=</span> <span class="fl">.2</span> <span class="co"># parameter for a non-decision time "non_dec"</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span>  <span class="co"># each model must have a condition (in this example it is not relevant, so we just call it "foo")</span></span>
<span>  <span class="va">conds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># get access to pre-built component functions</span></span>
<span>  <span class="va">comps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component_shelf.html">component_shelf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># call the drift_dm function which is the backbone of dRiftDM</span></span>
<span>  <span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/drift_dm.html">drift_dm</a></span><span class="op">(</span></span>
<span>    prms_model <span class="op">=</span> <span class="va">prms_model</span>,</span>
<span>    conds <span class="op">=</span> <span class="va">conds</span>,</span>
<span>    subclass <span class="op">=</span> <span class="st">"my_custom_model"</span>,</span>
<span>    mu_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">mu_constant</span>, <span class="co"># time-independent drift rate with parameter muc</span></span>
<span>    mu_int_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">mu_int_constant</span>, <span class="co"># respective integral of the drift rate</span></span>
<span>    x_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">x_dirac_0</span>, <span class="co"># dirac delta on zero</span></span>
<span>    b_fun <span class="op">=</span> <span class="va">cust_b</span>, <span class="co"># custom time-dependent boundary</span></span>
<span>    dt_b_fun <span class="op">=</span> <span class="va">cust_dt_b</span>, <span class="co"># respective derivative of the boundary</span></span>
<span>    nt_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">nt_constant</span> <span class="co"># non-decision time with parameter non_dec</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu">cust_model</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-custom-non-decision-time">Example: Custom Non-Decision Time<a class="anchor" aria-label="anchor" href="#example-custom-non-decision-time"></a>
</h3>
<p>Remark: This example shows a reimplementation of the already
pre-built <code><a href="../reference/nt_uniform.html">nt_uniform()</a></code> component function (see
<code><a href="../reference/component_shelf.html">component_shelf()</a></code>.</p>
<p>Suppose we want a uniform non-decision time distribution with
parameters <code>non_dec</code> and <code>range_non_dec</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_nt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prms_model</span>, <span class="va">prms_solve</span>, <span class="va">t_vec</span>, <span class="va">one_cond</span>, <span class="va">ddm_opts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># get the relevant parameters</span></span>
<span>  <span class="va">non_dec</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"non_dec"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">range_non_dec</span> <span class="op">&lt;-</span> <span class="va">prms_model</span><span class="op">[[</span><span class="st">"range_non_dec"</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># get the settings for the time space discretization</span></span>
<span>  <span class="va">t_max</span> <span class="op">&lt;-</span> <span class="va">prms_solve</span><span class="op">[[</span><span class="st">"t_max"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">prms_solve</span><span class="op">[[</span><span class="st">"dt"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># calculate the density</span></span>
<span>  <span class="va">d_nt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t_vec</span>, min <span class="op">=</span> <span class="va">non_dec</span> <span class="op">-</span> <span class="va">range_non_dec</span> <span class="op">/</span> <span class="fl">2</span>, max <span class="op">=</span> <span class="va">non_dec</span> <span class="op">+</span> <span class="va">range_non_dec</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">d_nt</span> <span class="op">&lt;-</span> <span class="va">d_nt</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">d_nt</span><span class="op">)</span> <span class="op">*</span> <span class="va">dt</span><span class="op">)</span> <span class="co"># ensure it integrates to 1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">d_nt</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then we write a function that assembles the custom model:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># define all parameters and conditions</span></span>
<span>  <span class="va">prms_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    non_dec <span class="op">=</span> <span class="fl">.2</span>, range_non_dec <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># parameters for the custom non-decision time</span></span>
<span>    muc <span class="op">=</span> <span class="fl">4</span>, <span class="co"># parameter for a time-independent drift rate</span></span>
<span>    b <span class="op">=</span> <span class="fl">.6</span> <span class="co"># parameter for a time-independent boundary</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span>  <span class="co"># each model must have a condition (in this example it is not relevant, so we just call it "foo")</span></span>
<span>  <span class="va">conds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"foo"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># get access to pre-built component functions</span></span>
<span>  <span class="va">comps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component_shelf.html">component_shelf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># call the drift_dm function which is the backbone of dRiftDM</span></span>
<span>  <span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/drift_dm.html">drift_dm</a></span><span class="op">(</span></span>
<span>    prms_model <span class="op">=</span> <span class="va">prms_model</span>,</span>
<span>    conds <span class="op">=</span> <span class="va">conds</span>,</span>
<span>    subclass <span class="op">=</span> <span class="st">"my_custom_model"</span>,</span>
<span>    mu_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">mu_constant</span>, <span class="co"># time-independent drift rate with parameter muc</span></span>
<span>    mu_int_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">mu_int_constant</span>, <span class="co"># respective integral of the drift rate</span></span>
<span>    x_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">x_dirac_0</span>, <span class="co"># dirac delta on zero</span></span>
<span>    b_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">b_constant</span>, <span class="co"># time-independent boundary b</span></span>
<span>    dt_b_fun <span class="op">=</span> <span class="va">comps</span><span class="op">$</span><span class="va">dt_b_constant</span>, <span class="co"># respective derivative of the boundary</span></span>
<span>    nt_fun <span class="op">=</span> <span class="va">cust_nt</span> <span class="co"># custom non-decision time </span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ddm</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu">cust_model</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="final-comments">Final Comments<a class="anchor" aria-label="anchor" href="#final-comments"></a>
</h3>
<p><strong>More Examples?</strong> The previous examples have shown you
how to tailor a model to your needs using custom component functions.
For more examples and inspiration, we suggest you take a look at the
source code of the predefined component functions. A list of all
component functions can be found in the documentation for
<code><a href="../reference/component_shelf.html">component_shelf()</a></code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">component_shelf</span></span></code></pre></div>
<p>The source code for each function is available on our Github page <a href="https://github.com/bucky2177/dRiftDM/blob/main/R/models.R" class="external-link">here</a>.
Alternatively, you can access the source code from R like this:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_funs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/component_shelf.html">component_shelf</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># all functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">all_funs</span><span class="op">$</span><span class="va">x_uniform</span><span class="op">)</span> <span class="co"># see the code for x_uniform</span></span></code></pre></div>
<p><strong>How do I check that the model is working as
intended?</strong> There are two ways to perform sanity checks. First,
to check the boundary and drift rate, you can plot the expected time
course of your diffusion model:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dmc_dm.html">dmc_dm</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_traces.html">simulate_traces</a></span><span class="op">(</span><span class="va">ddm</span>, k <span class="op">=</span> <span class="fl">1</span>, sigma <span class="op">=</span> <span class="fl">0</span>, add_x <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span></code></pre></div>
<p><img src="customize_ddms_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<p>Alternatively, you can plot the returned values of each component
function by passing the model object to the generic <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
method:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ddm</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="customize_ddms_files/figure-html/unnamed-chunk-36-1.png" width="700"><img src="customize_ddms_files/figure-html/unnamed-chunk-36-2.png" width="700"><img src="customize_ddms_files/figure-html/unnamed-chunk-36-3.png" width="700"><img src="customize_ddms_files/figure-html/unnamed-chunk-36-4.png" width="700"><img src="customize_ddms_files/figure-html/unnamed-chunk-36-5.png" width="700"></p>
<p><strong>What if I need to access an arbitrary R object within a
component function?</strong> Since each component function is called by
<code>dRiftDM</code> at runtime, users don’t have direct control over
the values passed as arguments. However, we have implemented a backdoor
via the <code>ddm_opts</code> argument of each component function. This
allows you to inject arbitrary R objects and evaluate them at runtime if
necessary. The following (not very creative) example shows how to do
this.</p>
<p>First, we write a custom component function that prints the
<code>ddm_opts</code> argument to the console. We then attach the string
“Hello World” to a model via the <code><a href="../reference/ddm_opts.html">ddm_opts()</a></code> method, set the
custom component function, and see the corresponding console output
after calling <code>re_evaluate()</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cust_mu</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prms_model</span>, <span class="va">prms_solve</span>, <span class="va">t_vec</span>, <span class="va">one_cond</span>, <span class="va">ddm_opts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ddm_opts</span><span class="op">)</span> <span class="co"># print out the values of ddm_opts</span></span>
<span>  <span class="va">muc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">prms_model</span><span class="op">[[</span><span class="st">"muc"</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t_vec</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">muc</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">a_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ratcliff_dm.html">ratcliff_dm</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># a dummy model for demonstration purpose</span></span>
<span><span class="fu"><a href="../reference/ddm_opts.html">ddm_opts</a></span><span class="op">(</span><span class="va">a_model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Hello World"</span> <span class="co"># attach "Hello World" to the model</span></span>
<span><span class="fu"><a href="../reference/comp_funs.html">comp_funs</a></span><span class="op">(</span><span class="va">a_model</span><span class="op">)</span><span class="op">[[</span><span class="st">"mu_fun"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cust_mu</span> <span class="co"># swap in the custom component function</span></span>
<span></span>
<span><span class="co"># evaluate the model (which will evaluate the custom drift rate function with the user-defined R </span></span>
<span><span class="co"># object for ddm_opts)</span></span>
<span><span class="va">a_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/re_evaluate_model.html">re_evaluate_model</a></span><span class="op">(</span><span class="va">a_model</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "Hello World"</span></span></code></pre></div>
<p>Because R is dynamic, we can attach arbitrary R objects and even
functions to the model via <code>ddm_opts</code> and thereby make them
available within our custom component functions.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Valentin Koob, Thomas Richter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
